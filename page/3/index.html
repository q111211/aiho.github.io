<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"aiho.site","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="��ͨ��ֻ�뵽��ζȹ�ʱ�䣬�в��ܵ����跨����ʱ�䡣�����屾��">
<meta property="og:type" content="website">
<meta property="og:title" content="aiho.site">
<meta property="og:url" content="http://aiho.site/page/3/index.html">
<meta property="og:site_name" content="aiho.site">
<meta property="og:description" content="��ͨ��ֻ�뵽��ζȹ�ʱ�䣬�в��ܵ����跨����ʱ�䡣�����屾��">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Li ChengHu">
<meta property="article:tag" content="aiho|aiho.site|aiho���˲���">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://aiho.site/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>aiho.site</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">aiho.site</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">aiho</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://aiho.site/2017/03/24/2017-03-24%2014-11_solr%E4%B9%8BfunctionQuery(%E5%87%BD%E6%95%B0%E6%9F%A5%E8%AF%A2)%E3%80%90%E8%BD%AC%E3%80%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Li ChengHu">
      <meta itemprop="description" content="��ͨ��ֻ�뵽��ζȹ�ʱ�䣬�в��ܵ����跨����ʱ�䡣�����屾��">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aiho.site">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/03/24/2017-03-24%2014-11_solr%E4%B9%8BfunctionQuery(%E5%87%BD%E6%95%B0%E6%9F%A5%E8%AF%A2)%E3%80%90%E8%BD%AC%E3%80%91/" class="post-title-link" itemprop="url">solr之functionQuery(函数查询)【转】</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-03-24 14:11:00" itemprop="dateCreated datePublished" datetime="2017-03-24T14:11:00+08:00">2017-03-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 00:08:10" itemprop="dateModified" datetime="2020-05-28T00:08:10+08:00">2020-05-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Solr/" itemprop="url" rel="index"><span itemprop="name">Solr</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>   函数查询 让我们可以利用 numeric域的值 或者 与域相关的的某个特定的值的函数，来对文档进行评分。</p>
<h2 id="怎样使用函数查询"><a href="#怎样使用函数查询" class="headerlink" title="怎样使用函数查询"></a>怎样使用函数查询</h2><pre><code>这里主要有两种方法可以使用函数查询，这两种方法都是通过solr http 接口的。</code></pre><ol>
<li><p>内嵌在正常的solr查询表达式中。即，将函数查询写在 q这个参数中，这时候，我们使用_val_将函数与其他的查询加以区别。至于具体怎样使用，请读者留意下面的例子。</p>
</li>
<li><p>使用明确为函数查询的参数，比如说dismax中的bf（boost function）这个参数。  注意：bf这个参数是可以接受多个函数查询的，它们之间用空格隔开，它们还可以带上权重。所以，当我们使用bf这个参数的时候，我们必须保证单个函数中是没有空格出现的，不然程序有可能会以为是两个函数。</p>
<pre><code>例如：  q=dismax&amp;bf=&quot;ord(popularity)^0.5 recip(rord(price),1,1000,1000)^0.3</code></pre></li>
</ol>
<h2 id="函数的格式（Function-Query-Syntax"><a href="#函数的格式（Function-Query-Syntax" class="headerlink" title="函数的格式（Function Query Syntax)"></a>函数的格式（Function Query Syntax)</h2><pre><code>目前，function query 并不支持 a+b 这样的形式，我们得把它写成一个方法形式，这就是 sum(a,b).</code></pre><h2 id="可以利用的函数-（available-function）"><a href="#可以利用的函数-（available-function）" class="headerlink" title="可以利用的函数 （available function）"></a>可以利用的函数 （available function）</h2><h3 id="constant"><a href="#constant" class="headerlink" title="constant"></a>constant</h3><pre><code>支持有小数点的常量

例如：1.5 ；

        SolrQuerySyntax:_val_:1.5</code></pre><h3 id="fieldvalue"><a href="#fieldvalue" class="headerlink" title="fieldvalue"></a>fieldvalue</h3><pre><code>这个函数将会返回numeric field的值，这个域必须是indexd的，非multiValued的。格式很简单，就是该域的名字。如果这个域中没有这样的值，那么将会返回0。</code></pre><h3 id="ord"><a href="#ord" class="headerlink" title="ord"></a>ord</h3><pre><code>       对于一个域，它所有的值都将会按照字典顺序排列，这个函数返回你要查询的那个特定的值在这个顺序中的排名。这个域，必须是非multiValued的，当没有值存在的时候，将返回0.

例如：某个特定的域只能去三个值，“apple”、“banana”、“pear”，那么ord（“apple”）=1，ord（“banana”）=2，ord（“pear”）=3.

 需要注意的是，ord（）这个函数，依赖于值在索引中的位置，所以当有文档被删除、或者添加的时候，ord（）的值就会发生变化。当你使用MultiSearcher的时候，这个值也就是不定的了。</code></pre><h3 id="rord"><a href="#rord" class="headerlink" title="rord"></a>rord</h3><pre><code>这个函数将会返回与ord相对应的倒排序的排名。

格式: rord(myIndexedField).</code></pre><h3 id="sum"><a href="#sum" class="headerlink" title="sum"></a>sum</h3><pre><code>这个函数的意思就显而易见啦，它就是表示“和”啦。

格式：sum(x,1)

         sum(x,y)

         sum(sqrt(x),log(y),z,0.5)</code></pre><h3 id="product"><a href="#product" class="headerlink" title="product"></a>product</h3><pre><code>   product(x,y,...)将会返回多个函数的乘积。

格式：product(x,2)

         product(x,y)</code></pre><h3 id="div"><a href="#div" class="headerlink" title="div"></a>div</h3><pre><code>  div(x,y)表示x除以y的值

格式：div（1,x）

         div(sum(x,100),max(y,1))</code></pre><h3 id="pow"><a href="#pow" class="headerlink" title="pow"></a>pow</h3><pre><code>pow表示幂值。pow(x,y) =x^y。

例如：pow(x,0.5) 表示开方

        pow(x,log(y))</code></pre><h3 id="abs"><a href="#abs" class="headerlink" title="abs"></a>abs</h3><pre><code> abs(x)将返回表达式的绝对值

格式：abs(-5)

格式：abs(x)</code></pre><h3 id="log"><a href="#log" class="headerlink" title="log"></a>log</h3><pre><code> log(x)将会返回基数为10，x的对数

格式： log(x)

           log(sum(x,100))</code></pre><h3 id="sqrt"><a href="#sqrt" class="headerlink" title="sqrt"></a>sqrt</h3><pre><code>sqrt(x) 返回 一个数的平方根

格式：sqrt（2）

         sqrt(sum(x,100))</code></pre><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><pre><code> 如果 x&gt;=min,且x&lt;=max,那么map(x,min,max,target)=target.

 如果 x不在[min,max]这个区间内，那么map(x,min,max,target)=x.

格式：map(x,0,0,1)</code></pre><h3 id="scale"><a href="#scale" class="headerlink" title="scale"></a>scale</h3><pre><code>scale(x,minTarget,maxTarget) 这个函数将会把x的值限制在[minTarget,maxTarget]范围内。</code></pre><h3 id="query"><a href="#query" class="headerlink" title="query"></a>query</h3><pre><code>query(subquery,default)将会返回给定subquery的分数，如果subquery与文档不匹配，那么将会返回默认值。任何的查询类型都是受支持的。

可以通过引用的方式，也可以直接指定查询串。

例子：**q=product(popularity, query({!dismax v=&apos;solr rocks&apos;})** 将会返回popularity和通过dismax 查询得到的分数的乘积。

         **q=product(popularity, query($qq)&amp;qq={!dismax}solr rocks** 跟上一个例子的效果是一样的。不过这里使用的是引用的方式

         **q=product(popularity, query($qq,0.1)&amp;qq={!dismax}solr rocks** 在前一个例子的基础上又加了一个默认值。</code></pre><h3 id="linear"><a href="#linear" class="headerlink" title="linear"></a>linear</h3><pre><code>linear(x,m,c)表示 m*x+c ,其中m和c都是常量，x是一个变量也可以是一个函数。

例如： linear(x,2,4)=2*x+4.</code></pre><h3 id="recip"><a href="#recip" class="headerlink" title="recip"></a>recip</h3><pre><code> recip(x,m,a,b)=a/(m*x+b)其中，m、a、b是常量，x是变量或者一个函数。

 当a=b，并且x&gt;=0的时候，这个函数的最大值是1，值的大小随着x的增大而减小。

例如：recip(rord(creationDate),1,1000,1000)</code></pre><h3 id="max"><a href="#max" class="headerlink" title="max"></a>max</h3><pre><code> max(x,c)将会返回一个函数和一个常量之间的最大值。

例如：max(myfield,0)</code></pre><p><strong><em>源文地址：<span style="text-decoration: underline;"><a href="http://mxsfengg.iteye.com/blog/352191" target="_blank" rel="noopener">http://mxsfengg.iteye.com/blog/352191</a></span></em></strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://aiho.site/2016/12/27/2016-12-27%2011-30_4.0%E4%B8%AD%E7%9A%84%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97%E5%92%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%AF%A6%E8%A7%A3(%E4%B8%80)%E3%80%90%E8%BD%AC%E3%80%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Li ChengHu">
      <meta itemprop="description" content="��ͨ��ֻ�뵽��ζȹ�ʱ�䣬�в��ܵ����跨����ʱ�䡣�����屾��">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aiho.site">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/27/2016-12-27%2011-30_4.0%E4%B8%AD%E7%9A%84%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97%E5%92%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%AF%A6%E8%A7%A3(%E4%B8%80)%E3%80%90%E8%BD%AC%E3%80%91/" class="post-title-link" itemprop="url">4.0中的并行计算和多线程详解(一)【转】</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-12-27 11:30:00" itemprop="dateCreated datePublished" datetime="2016-12-27T11:30:00+08:00">2016-12-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 00:08:10" itemprop="dateModified" datetime="2020-05-28T00:08:10+08:00">2020-05-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="并行计算部分"><a href="#并行计算部分" class="headerlink" title="并行计算部分"></a>并行计算部分</h1><pre><code>沿用微软的写法，System.Threading.Tasks.::.Parallel类，提供对并行循环和区域的支持。 我们会用到的方法有For，ForEach，Invoke。</code></pre><h2 id="一、简单使用"><a href="#一、简单使用" class="headerlink" title="一、简单使用"></a>一、简单使用</h2><pre><code>首先我们初始化一个List用于循环，这里我们循环10次。（后面的代码都会按这个标准进行循环）</code></pre><div>
<div>Code
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://aiho.site/2016/12/20/2016-12-20%2013-50_%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2Solr%E9%9B%86%E6%88%90HanLP%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E3%80%90%E8%BD%AC%E3%80%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Li ChengHu">
      <meta itemprop="description" content="��ͨ��ֻ�뵽��ζȹ�ʱ�䣬�в��ܵ����跨����ʱ�䡣�����屾��">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aiho.site">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/20/2016-12-20%2013-50_%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2Solr%E9%9B%86%E6%88%90HanLP%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E3%80%90%E8%BD%AC%E3%80%91/" class="post-title-link" itemprop="url">全文检索Solr集成HanLP中文分词【转】</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-12-20 13:50:00" itemprop="dateCreated datePublished" datetime="2016-12-20T13:50:00+08:00">2016-12-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 00:08:11" itemprop="dateModified" datetime="2020-05-28T00:08:11+08:00">2020-05-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>以前发布过<a href="https://github.com/hankcs/HanLP" target="_blank" rel="noopener">HanLP</a>的Lucene插件，后来很多人跟我说其实Solr更流行（反正我是觉得既然Solr是Lucene的子项目，那么稍微改改配置就能支持Solr），于是就抽空做了个Solr插件出来，开源在<a href="https://github.com/hankcs/hanlp-solr-plugin" target="_blank" rel="noopener">Github</a>上，欢迎改进。</p>
<p>HanLP中文分词solr插件支持Solr5.x，兼容Lucene5.x。</p>
<p><img src="http://7xqdjc.com1.z0.glb.clouddn.com/blog_338023-20161220135231448-1003250351.png" alt=""></p>
<h2 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h2><ol>
<li></li>
</ol>
<p>将<a href="http://search.maven.org/#search%7Cgav%7C1%7Cg%3A%22com.hankcs%22%20AND%20a%3A%22hanlp%22" target="_blank" rel="noopener">hanlp-portable.jar</a>和<a href="https://github.com/hankcs/hanlp-solr-plugin/releases" target="_blank" rel="noopener">hanlp-solr-plugin.jar</a>共两个jar放入<code>${webapp}/WEB-INF/lib</code>下</p>
<ol start="2">
<li></li>
</ol>
<p>修改solr core的配置文件<code>${core}/conf/schema.xml</code>：</p>
<p><code class="hljs scala"><fieldType name=<span class="hljs-string">"text_cn" <span class="hljs-class"><span class="hljs-keyword">class=<span class="hljs-string">"solr.TextField">    <analyzer <span class="hljs-class"><span class="hljs-keyword">type=<span class="hljs-string">"index" enableIndexMode=<span class="hljs-string">"true" <span class="hljs-class"><span class="hljs-keyword">class=<span class="hljs-string">"com.hankcs.lucene.HanLPAnalyzer"/>    <analyzer <span class="hljs-class"><span class="hljs-keyword">type=<span class="hljs-string">"query" enableIndexMode=<span class="hljs-string">"true" <span class="hljs-class"><span class="hljs-keyword">class=<span class="hljs-string">"com.hankcs.lucene.HanLPAnalyzer"/></fieldType></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></p>
<h2 id="效果一览"><a href="#效果一览" class="headerlink" title="效果一览"></a>效果一览</h2><p>对于新手来说，上面的两步可能太简略了，不如看看下面的step by step</p>
<h3 id="启动solr"><a href="#启动solr" class="headerlink" title="启动solr"></a>启动solr</h3><p>首先在solr-5.2.1\bin目录下启动solr：</p>
<p><code class="hljs bash">solr start <span class="hljs-_">-f</span></code></p>
<p>用浏览器打开<a href="http://localhost:8983/solr/#/" target="_blank" rel="noopener">http://localhost:8983/solr/#/</a>，看到如下页面说明一切正常：</p>
<p><img src="http://static.oschina.net/uploads/img/201511/24114444_OERB.jpg" alt="" title="solr启动.png"></p>
<h3 id="创建core"><a href="#创建core" class="headerlink" title="创建core"></a>创建core</h3><p>在solr-5.2.1\server\solr下新建一个目录，取个名字比如叫one，将 示例配置文件solr-5.2.1\server\solr\configsets\sample_techproducts_configs\conf 拷贝过来，对conf目录下的schema.xml做上述一步改动，意思是使用HanLP分词器来对text_cn域进行分词。接着修改 schema.xml中的默认域type，搜索</p>
<p><code class="hljs scala"><field name=<span class="hljs-string">"text" <span class="hljs-class"><span class="hljs-keyword">type=<span class="hljs-string">"text" indexed=<span class="hljs-string">"true" stored=<span class="hljs-string">"false" multiValued=<span class="hljs-string">"true"/></span></span></span></span></span></span></span></code></p>
<p>修改为</p>
<p><code class="hljs scala"><field name=<span class="hljs-string">"text" <span class="hljs-class"><span class="hljs-keyword">type=<span class="hljs-string">"text_cn" indexed=<span class="hljs-string">"true" stored=<span class="hljs-string">"false" multiValued=<span class="hljs-string">"true"/></span></span></span></span></span></span></span></code></p>
<p>意思是默认文本为text_cn类型。</p>
<p>完成了之后在solr的管理界面导入这个core one：</p>
<p><img src="http://static.oschina.net/uploads/img/201511/24114444_2X6t.jpg" alt="" title="solr添加core.png"></p>
<p>接着就能在下拉列表中看到这个core了：</p>
<p><img src="http://static.oschina.net/uploads/img/201511/24114444_fJcu.jpg" alt="" title="选中core.png"></p>
<h3 id="上传测试文档"><a href="#上传测试文档" class="headerlink" title="上传测试文档"></a>上传测试文档</h3><p>修改好了，就可以拿一些测试文档来试试效果了。hanlp-solr-plugin代码库中的src/test/resources下有个测试文档集合documents.csv，其内容如下：</p>
<p><code class="hljs objectivec"><span class="hljs-keyword">id,title1,你好世界<span class="hljs-number">2,商品和服务<span class="hljs-number">3,和服的价格是每镑<span class="hljs-number">15便士<span class="hljs-number">4,服务大众<span class="hljs-number">5,hanlp工作正常</span></span></span></span></span></span></code></p>
<p>代表着id从1到5共五个文档，接下来复制solr-5.2.1\example\exampledocs下的上传工具post.jar到resources目录，利用如下命令行将数据导入：</p>
<p><code class="hljs nginx"><span class="hljs-attribute">java -Dc=one -Dtype=application/csv -jar post.jar <span class="hljs-regexp">*.csv</span></span></code></p>
<p>Windows用户的话直接双击该目录下的upload.cmd即可。</p>
<p>正常情况下输出如下结果：</p>
<p><code class="hljs sql">SimplePostTool version 5.0.0Posting files to [base] url <a href="http://localhost:8983/solr/one/" target="_blank" rel="noopener">http://localhost:8983/solr/one/</a><span class="hljs-keyword">update <span class="hljs-keyword">using <span class="hljs-keyword">content-<span class="hljs-keyword">type application/csv...POSTing <span class="hljs-keyword">file documents.csv <span class="hljs-keyword">to [base]<span class="hljs-number">1 files indexed.COMMITting Solr <span class="hljs-keyword">index changes <span class="hljs-keyword">to <span class="hljs-keyword"><a href="http://localhost" target="_blank" rel="noopener">http://localhost</a>:<span class="hljs-number">8983/solr/one/update...Time spent: <span class="hljs-number">0:<span class="hljs-number">00:<span class="hljs-number">00.059请按任意键继续. . .</span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></p>
<p>同时刷新一下core one的Overview，的确看到了5篇文档：</p>
<p><img src="http://static.oschina.net/uploads/img/201511/24114444_lCcv.jpg" alt="" title="solr文档导入成功.png"></p>
<h3 id="搜索文档"><a href="#搜索文档" class="headerlink" title="搜索文档"></a>搜索文档</h3><p>是时候看看HanLP分词的效果了，点击左侧面板的Query，输入“和服”试试：</p>
<p><img src="http://static.oschina.net/uploads/img/201511/24114444_2g1r.jpg" alt="" title="solr中文搜索.png"></p>
<p>发现精确地查到了“<strong>和服</strong>的价格是每镑15便士”，而不是“商品<strong>和服</strong>务”这种错误文档：</p>
<p><img src="http://static.oschina.net/uploads/img/201511/24114444_Wq7s.jpg" alt="" title="精确命中.png"></p>
<p>这说明HanLP工作良好。</p>
<p>要知道，不少中文分词器眉毛胡子一把抓地命中“商品<strong>和服</strong>务”这种错误文档，降低了查准率，拉低了用户体验，跟原始的MySQL LIKE有何区别？</p>
<h2 id="代码调用"><a href="#代码调用" class="headerlink" title="代码调用"></a>代码调用</h2><p>在Query改写的时候，可以利用HanLPAnalyzer分词结果中的词性等属性，如</p>
<p><code class="hljs ruby">String text = <span class="hljs-string">"中华人民共和国很辽阔";<span class="hljs-keyword">for (int i = <span class="hljs-number">0; i < text.length(); ++i){    System.out.print(text.charAt(i) + <span class="hljs-string">"" + i + <span class="hljs-string">" ");}System.out.println();Analyzer analyzer = new HanLPAnalyzer();TokenStream tokenStream = analyzer.tokenStream(<span class="hljs-string">"field", text);tokenStream.reset();<span class="hljs-keyword">while (tokenStream.incrementToken()){    CharTermAttribute attribute = tokenStream.getAttribute(CharTermAttribute.<span class="hljs-keyword">class);    <span class="hljs-regexp">// 偏移量    OffsetAttribute offsetAtt = tokenStream.getAttribute(OffsetAttribute.<span class="hljs-keyword">class);    <span class="hljs-regexp">// 距离    PositionIncrementAttribute positionAttr = kenStream.getAttribute(PositionIncrementAttribute.<span class="hljs-keyword">class);    <span class="hljs-regexp">// 词性    TypeAttribute typeAttr = tokenStream.getAttribute(TypeAttribute.<span class="hljs-keyword">class);    System.out.printf(<span class="hljs-string">"[%d:%d %d] %s/%s\n", offsetAtt.startOffset(), offsetAtt.endOffset(), positionAttr.getPositionIncrement(), attribute, typeAttr.type());}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></p>
<p>在另一些场景，支持以自定义的分词器（比如开启了命名实体识别的分词器、繁体中文分词器、CRF分词器等）构造HanLPTokenizer，比如：</p>
<p><code class="hljs lisp">tokenizer = new HanLPTokenizer(<span class="hljs-name">HanLP.newSegment()                    .enableJapaneseNameRecognize(<span class="hljs-name">true)                    .enableIndexMode(<span class="hljs-name">true), null, false)<span class="hljs-comment">;tokenizer.setReader(new StringReader("林志玲亮相网友:确定不是波多野结衣？"));...</span></span></span></span></code></p>
<h2 id="高级配置"><a href="#高级配置" class="headerlink" title="高级配置"></a>高级配置</h2><p>HanLP分词器主要通过class path下的<code>hanlp.properties</code>进行配置，请阅读<a href="https://github.com/hankcs/HanLP" target="_blank" rel="noopener">HanLP自然语言处理包文档</a>以了解更多相关配置，如：</p>
<ol>
<li></li>
</ol>
<p>停用词</p>
<ol start="2">
<li></li>
</ol>
<p>用户词典</p>
<ol start="3">
<li></li>
</ol>
<p>词性标注</p>
<ol start="4">
<li></li>
</ol>
<p>……</p>
<p><em>原文地址：<a href="http://www.hankcs.com/nlp/segment/full-text-retrieval-solr-integrated-hanlp-chinese-word-segmentation.html" target="_blank" rel="noopener">http://www.hankcs.com/nlp/segment/full-text-retrieval-solr-integrated-hanlp-chinese-word-segmentation.html</a></em></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://aiho.site/2016/12/07/2016-12-07%2012-23_js%20%E5%AE%9E%E7%8E%B0%20input%20file%20%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Li ChengHu">
      <meta itemprop="description" content="��ͨ��ֻ�뵽��ζȹ�ʱ�䣬�в��ܵ����跨����ʱ�䡣�����屾��">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aiho.site">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/07/2016-12-07%2012-23_js%20%E5%AE%9E%E7%8E%B0%20input%20file%20%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" class="post-title-link" itemprop="url">js 实现 input file 文件上传</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-12-07 12:23:00" itemprop="dateCreated datePublished" datetime="2016-12-07T12:23:00+08:00">2016-12-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 00:08:11" itemprop="dateModified" datetime="2020-05-28T00:08:11+08:00">2020-05-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <div class="cnblogs_Highlighter">

<!DOCTYPE html><p><br>    <html xmlns="http://www.w3.org/1999/xhtml"><br>    <head runat="server"><br>    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><br>    <script src="js/jquery/jquery-1.8.2.min.js" type="text/javascript"></script><br>    <style type="text/css"><br>    ._box<br>    {<br>    width: 119px;<br>    height: 37px;<br>    background-color: #53AD3F;<br>    background-image: url(images/bg.png);<br>    background-repeat: no-repeat;<br>    background-position: 0 0;<br>    background-attachment: scroll;<br>    line-height: 37px;<br>    text-align: center;<br>    color: white;<br>    cursor: pointer;<br>    }<br>    .none<br>    {<br>    width: 0px;<br>    height: 0px;<br>    display: none;<br>    }<br>    </style><br>    <title>js 实现 input file 文件上传 /&gt;</title><br>    </head><br>    <body><br>    <form id="form1" runat="server" method="post" enctype="multipart/form-data"><br>    <div><br>    <div class="_box">选择图片</div><br>    </div><br>    <div class="none"><br>    <input type="file" name="_f" id="_f" /><br>    </div><br>    </form><br>    </body><br>    </html><br>    <script type="text/javascript"><br>    jQuery(function () {<br>    $("._box").click(function () {<br>    return $("#_f").click();<br>    });<br>    });<br>    </script> </p>
</div>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://aiho.site/2016/09/06/2016-09-06%2010-05_cdn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Li ChengHu">
      <meta itemprop="description" content="��ͨ��ֻ�뵽��ζȹ�ʱ�䣬�в��ܵ����跨����ʱ�䡣�����屾��">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aiho.site">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/09/06/2016-09-06%2010-05_cdn/" class="post-title-link" itemprop="url">cdn</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-09-06 10:05:00" itemprop="dateCreated datePublished" datetime="2016-09-06T10:05:00+08:00">2016-09-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 00:08:11" itemprop="dateModified" datetime="2020-05-28T00:08:11+08:00">2020-05-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="http://files.cnblogs.com/files/chenghu/html5shiv.js" target="_blank" rel="noopener">http://files.cnblogs.com/files/chenghu/html5shiv.js</a></p>
<p><span style="line-height: 1.5;"><a href="http://files.cnblogs.com/files/chenghu/respond.min.js" target="_blank" rel="noopener">http://files.cnblogs.com/files/chenghu/respond.min.js</a></span></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://aiho.site/2016/08/30/2016-08-30%2010-50_.NET%E4%BD%BF%E7%94%A8NPOI%E7%BB%84%E4%BB%B6%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BAExcel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Li ChengHu">
      <meta itemprop="description" content="��ͨ��ֻ�뵽��ζȹ�ʱ�䣬�в��ܵ����跨����ʱ�䡣�����屾��">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aiho.site">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/08/30/2016-08-30%2010-50_.NET%E4%BD%BF%E7%94%A8NPOI%E7%BB%84%E4%BB%B6%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BAExcel/" class="post-title-link" itemprop="url">.NET使用NPOI组件将数据导出Excel</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-08-30 10:50:00" itemprop="dateCreated datePublished" datetime="2016-08-30T10:50:00+08:00">2016-08-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 00:08:12" itemprop="dateModified" datetime="2020-05-28T00:08:12+08:00">2020-05-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>.NET调用NPOI组件导入导出Excel**</strong>的操作类<br>**　　此NPOI操作类的优点如下：<br>（1）支持web及winform从DataTable导出到Excel； </p>
<p>（2）生成速度很快；<br>（3）准确判断数据类型，不会出现身份证转数值等问题；<br>（4）如果单页条数大于65535时会新建工作表； </p>
<p>（5）列宽自适应；</p>
<p><strong>NPOI操作类</strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('bd02877a-7c28-428a-a3bd-9f50d6119057')">![](https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif)![](https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif)
<div id="cnblogs_code_open_bd02877a-7c28-428a-a3bd-9f50d6119057" class="cnblogs_code_hide">

<p><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> NPOIHelper<br>        {<br>            </span><span style="color: #808080;">///</span> <span style="color: #808080;"><summary></span><br>            <span style="color: #808080;">///</span><span style="color: #008000;"> DataTable导出到Excel文件<br>            </span><span style="color: #808080;">///</span> <span style="color: #808080;"></summary></span><br>            <span style="color: #808080;">///</span> <span style="color: #808080;"><param name="dtSource"></span><span style="color: #008000;">源DataTable</span><span style="color: #808080;"></param></span><br>            <span style="color: #808080;">///</span> <span style="color: #808080;"><param name="strHeaderText"></span><span style="color: #008000;">表头文本</span><span style="color: #808080;"></param></span><br>            <span style="color: #808080;">///</span> <span style="color: #808080;"><param name="strFileName"></span><span style="color: #008000;">保存位置</span><span style="color: #808080;"></param></span><br>            <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> Export(DataTable dtSource, <span style="color: #0000ff;">string</span> strHeaderText, <span style="color: #0000ff;">string</span><span style="color: #000000;"> strFileName)<br>            {<br>                </span><span style="color: #0000ff;">using</span> (MemoryStream ms =<span style="color: #000000;"> Export(dtSource, strHeaderText))<br>                {<br>                    </span><span style="color: #0000ff;">using</span> (FileStream fs = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FileStream(strFileName, FileMode.Create, FileAccess.Write))<br>                    {<br>                        </span><span style="color: #0000ff;">byte</span>[] data =<span style="color: #000000;"> ms.ToArray();<br>                        fs.Write(data, </span><span style="color: #800080;">0</span><span style="color: #000000;">, data.Length);<br>                        fs.Flush();<br>                    }<br>                }<br>            }</p>
<pre><code>        &lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;summary&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; DataTable导出到Excel的MemoryStream
        &lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;/summary&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;param name=&quot;dtSource&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;源DataTable&lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;&lt;/param&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;param name=&quot;strHeaderText&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;表头文本&lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;&lt;/param&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #0000ff;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt; MemoryStream Export(DataTable dtSource, &lt;span style=&quot;color: #0000ff;&quot;&gt;string&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; strHeaderText)
        {
            HSSFWorkbook workbook &lt;/span&gt;= &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; HSSFWorkbook();
            HSSFSheet sheet &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; workbook.CreateSheet();

            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;#region&lt;/span&gt; 右击文件 属性信息&lt;span style=&quot;color: #000000;&quot;&gt;
            {
                DocumentSummaryInformation dsi &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; PropertySetFactory.CreateDocumentSummaryInformation();
                dsi.Company &lt;/span&gt;= &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;NPOI&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                workbook.DocumentSummaryInformation &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; dsi;

                SummaryInformation si &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; PropertySetFactory.CreateSummaryInformation();
                si.Author &lt;/span&gt;= &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;文件作者信息&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;; &lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;填加xls文件作者信息&lt;/span&gt;
                si.ApplicationName = &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;创建程序信息&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;; &lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;填加xls文件创建程序信息&lt;/span&gt;
                si.LastAuthor = &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;最后保存者信息&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;; &lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;填加xls文件最后保存者信息&lt;/span&gt;
                si.Comments = &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;作者信息&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;; &lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;填加xls文件作者信息&lt;/span&gt;
                si.Title = &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;标题信息&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;; &lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;填加xls文件标题信息&lt;/span&gt;
                si.Subject = &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;主题信息&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;填加文件主题信息&lt;/span&gt;
                si.CreateDateTime =&lt;span style=&quot;color: #000000;&quot;&gt; DateTime.Now;
                workbook.SummaryInformation &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; si;
            }
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;#endregion&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;

            HSSFCellStyle dateStyle &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; workbook.CreateCellStyle();
            HSSFDataFormat format &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; workbook.CreateDataFormat();
            dateStyle.DataFormat &lt;/span&gt;= format.GetFormat(&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;yyyy-mm-dd&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);

            &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;取得列宽&lt;/span&gt;
            &lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt;[] arrColWidth = &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;[dtSource.Columns.Count];
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;foreach&lt;/span&gt; (DataColumn item &lt;span style=&quot;color: #0000ff;&quot;&gt;in&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; dtSource.Columns)
            {
                arrColWidth[item.Ordinal] &lt;/span&gt;= Encoding.GetEncoding(&lt;span style=&quot;color: #800080;&quot;&gt;936&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;).GetBytes(item.ColumnName.ToString()).Length;
            }
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; i = &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;; i &lt; dtSource.Rows.Count; i++&lt;span style=&quot;color: #000000;&quot;&gt;)
            {
                &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; j = &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;; j &lt; dtSource.Columns.Count; j++&lt;span style=&quot;color: #000000;&quot;&gt;)
                {
                    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; intTemp = Encoding.GetEncoding(&lt;span style=&quot;color: #800080;&quot;&gt;936&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;).GetBytes(dtSource.Rows[i][j].ToString()).Length;
                    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (intTemp &gt;&lt;span style=&quot;color: #000000;&quot;&gt; arrColWidth[j])
                    {
                        arrColWidth[j] &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; intTemp;
                    }
                }
            }
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; rowIndex = &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;foreach&lt;/span&gt; (DataRow row &lt;span style=&quot;color: #0000ff;&quot;&gt;in&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; dtSource.Rows)
            {
                &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;#region&lt;/span&gt; 新建表，填充表头，填充列头，样式
                &lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (rowIndex == &lt;span style=&quot;color: #800080;&quot;&gt;10000&lt;/span&gt; || rowIndex == &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
                {
                    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (rowIndex != &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
                    {
                        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (strHeaderText.Length &gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
                            sheet &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; workbook.CreateSheet(strHeaderText);
                        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;else&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;
                            sheet &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; workbook.CreateSheet();
                    }

                    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;#region&lt;/span&gt; 表头及样式&lt;span style=&quot;color: #000000;&quot;&gt;
                    {
                        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (strHeaderText.Length &gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
                        {
                            HSSFRow headerRow &lt;/span&gt;= sheet.CreateRow(&lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
                            headerRow.HeightInPoints &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;25&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                            headerRow.CreateCell(&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;).SetCellValue(strHeaderText);

                            HSSFCellStyle headStyle &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; workbook.CreateCellStyle();
                            headStyle.Alignment &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; NPOI.HSSF.UserModel.HSSFCellStyle.ALIGN_CENTER;
                            HSSFFont font &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; workbook.CreateFont();
                            font.FontHeightInPoints &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;20&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                            font.Boldweight &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;700&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                            headStyle.SetFont(font);
                            headerRow.GetCell(&lt;/span&gt;&lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;).CellStyle =&lt;span style=&quot;color: #000000;&quot;&gt; headStyle;
                            sheet.AddMergedRegion(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt; Region(&lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;, &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;, &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;, dtSource.Columns.Count - &lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;));
                        }
                        &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;headerRow.Dispose();&lt;/span&gt;
&lt;span style=&quot;color: #000000;&quot;&gt;                    }
                    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;#endregion&lt;/span&gt;

                    &lt;span style=&quot;color: #0000ff;&quot;&gt;#region&lt;/span&gt; 列头及样式&lt;span style=&quot;color: #000000;&quot;&gt;
                    {
                        HSSFRow headerRow &lt;/span&gt;= sheet.CreateRow(&lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
                        HSSFCellStyle headStyle &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; workbook.CreateCellStyle();
                        headStyle.Alignment &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; NPOI.HSSF.UserModel.HSSFCellStyle.ALIGN_CENTER;
                        HSSFFont font &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; workbook.CreateFont();
                        font.FontHeightInPoints &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;10&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                        font.Boldweight &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;700&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                        headStyle.SetFont(font);
                        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;foreach&lt;/span&gt; (DataColumn column &lt;span style=&quot;color: #0000ff;&quot;&gt;in&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; dtSource.Columns)
                        {
                            headerRow.CreateCell(column.Ordinal).SetCellValue(column.ColumnName);
                            headerRow.GetCell(column.Ordinal).CellStyle &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; headStyle;

                            &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;设置列宽&lt;/span&gt;
                            sheet.SetColumnWidth(column.Ordinal, (arrColWidth[column.Ordinal] + &lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;) * &lt;span style=&quot;color: #800080;&quot;&gt;256&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
                        }
                        &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; headerRow.Dispose();&lt;/span&gt;
&lt;span style=&quot;color: #000000;&quot;&gt;                    }
                    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;#endregion&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;

                    rowIndex &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                }
                &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;#endregion&lt;/span&gt;

                &lt;span style=&quot;color: #0000ff;&quot;&gt;#region&lt;/span&gt; 填充内容&lt;span style=&quot;color: #000000;&quot;&gt;
                HSSFRow dataRow &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; sheet.CreateRow(rowIndex);
                &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;foreach&lt;/span&gt; (DataColumn column &lt;span style=&quot;color: #0000ff;&quot;&gt;in&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; dtSource.Columns)
                {
                    HSSFCell newCell &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; dataRow.CreateCell(column.Ordinal);

                    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;string&lt;/span&gt; drValue =&lt;span style=&quot;color: #000000;&quot;&gt; row[column].ToString();

                    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;switch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (column.DataType.ToString())
                    {
                        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;System.String&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;:&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;字符串类型&lt;/span&gt;
                            drValue = drValue.Replace(&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&amp;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;, &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&amp;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
                            drValue &lt;/span&gt;= drValue.Replace(&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&gt;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;, &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&gt;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
                            drValue &lt;/span&gt;= drValue.Replace(&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&lt;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;, &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&lt;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
                            newCell.SetCellValue(drValue);
                            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;System.DateTime&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;:&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;日期类型&lt;/span&gt;
&lt;span style=&quot;color: #000000;&quot;&gt;                            DateTime dateV;
                            DateTime.TryParse(drValue, &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;out&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; dateV);
                            newCell.SetCellValue(dateV);

                            newCell.CellStyle &lt;/span&gt;= dateStyle;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;格式化显示&lt;/span&gt;
                            &lt;span style=&quot;color: #0000ff;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;System.Boolean&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;:&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;布尔型&lt;/span&gt;
                            &lt;span style=&quot;color: #0000ff;&quot;&gt;bool&lt;/span&gt; boolV = &lt;span style=&quot;color: #0000ff;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;bool&lt;/span&gt;.TryParse(drValue, &lt;span style=&quot;color: #0000ff;&quot;&gt;out&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; boolV);
                            newCell.SetCellValue(boolV);
                            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;System.Int16&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;:&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;整型&lt;/span&gt;
                        &lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;System.Int32&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;:&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;整型&lt;/span&gt;
                        &lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;System.Int64&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;:&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;整型&lt;/span&gt;
                        &lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;System.Int&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;:&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;整型&lt;/span&gt;
                            &lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; invV = &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt;.TryParse(drValue, &lt;span style=&quot;color: #0000ff;&quot;&gt;out&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; invV);
                            newCell.SetCellValue(invV);
                            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;

                        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;System.Byte&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;:
                            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; intV = &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt;.TryParse(drValue, &lt;span style=&quot;color: #0000ff;&quot;&gt;out&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; intV);
                            newCell.SetCellValue(intV);
                            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;System.Decimal&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;:&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;浮点型                           &lt;/span&gt;
                        &lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;System.Double&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;:
                            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;double&lt;/span&gt; doubV = &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;double&lt;/span&gt;.TryParse(drValue, &lt;span style=&quot;color: #0000ff;&quot;&gt;out&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; doubV);
                            newCell.SetCellValue(doubV);
                            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;System.DBNull&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;:&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;空值处理&lt;/span&gt;
                            newCell.SetCellValue(&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
                            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;default&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;:
                            newCell.SetCellValue(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
                            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                    }

                }
                &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;#endregion&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;

                rowIndex&lt;/span&gt;++&lt;span style=&quot;color: #000000;&quot;&gt;;
            }
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;using&lt;/span&gt; (MemoryStream ms = &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; MemoryStream())
            {
                workbook.Write(ms);
                ms.Flush();
                ms.Position &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;

                &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;sheet.Dispose();
                &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;workbook.Dispose();&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;一般只用写这一个就OK了，他会遍历并释放所有资源，但当前版本有问题所以只释放sheet&lt;/span&gt;
                &lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; ms;
            }
        }

        &lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;summary&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 用于Web导出
        &lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;/summary&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;param name=&quot;dtSource&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;源DataTable&lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;&lt;/param&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;param name=&quot;strHeaderText&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;表头文本&lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;&lt;/param&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;param name=&quot;strFileName&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;文件名&lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;&lt;/param&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #0000ff;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;void&lt;/span&gt; ExportByWeb(DataTable dtSource, &lt;span style=&quot;color: #0000ff;&quot;&gt;string&lt;/span&gt; strHeaderText, &lt;span style=&quot;color: #0000ff;&quot;&gt;string&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; strFileName)
        {
            HttpContext curContext &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; HttpContext.Current;

            &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 设置编码和附件格式&lt;/span&gt;
            curContext.Response.ContentType = &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;application/vnd.ms-excel&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
            curContext.Response.ContentEncoding &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; Encoding.UTF8;
            curContext.Response.Charset &lt;/span&gt;= &lt;span style=&quot;color: #800000;&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
            curContext.Response.AppendHeader(&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;Content-Disposition&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;,
                &lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;attachment;filename=&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt; +&lt;span style=&quot;color: #000000;&quot;&gt; HttpUtility.UrlEncode(strFileName, Encoding.UTF8));

            curContext.Response.BinaryWrite(Export(dtSource, strHeaderText).GetBuffer());
            curContext.Response.End();
        }

        &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;public static DataTable Import(string strFileName, int sheetindex)
        &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;{
        &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;    return Import(strFileName, sheetindex);
        &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;}&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;summary&gt;&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;读取excel
        &lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 默认第一行为标头
        &lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;/summary&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;param name=&quot;strFileName&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;excel文档路径&lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;&lt;/param&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;returns&gt;&lt;/returns&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #0000ff;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt; DataTable Import(&lt;span style=&quot;color: #0000ff;&quot;&gt;string&lt;/span&gt; strFileName, &lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; sheetindex, &lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; recordcount, &lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; topcount)
        {
            DataTable dt &lt;/span&gt;= &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; DataTable();

            HSSFWorkbook hssfworkbook;
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;using&lt;/span&gt; (FileStream file = &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; FileStream(strFileName, FileMode.Open, FileAccess.Read))
            {
                hssfworkbook &lt;/span&gt;= &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; HSSFWorkbook(file);
            }

            HSSFSheet sheet &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; hssfworkbook.GetSheetAt(sheetindex);
            System.Collections.IEnumerator rows &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; sheet.GetRowEnumerator();
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (topcount == &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
                topcount &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
            HSSFRow headerRow &lt;/span&gt;= sheet.GetRow(&lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt; + topcount - &lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; cellCount =&lt;span style=&quot;color: #000000;&quot;&gt; headerRow.LastCellNum;

            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; j = &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;; j &lt; cellCount; j++&lt;span style=&quot;color: #000000;&quot;&gt;)
            {
                HSSFCell cell &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; headerRow.GetCell(j);
                &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (cell == &lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
                    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;continue&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                dt.Columns.Add(cell.ToString());
            }

            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; i = (sheet.FirstRowNum + topcount); i &lt;= sheet.LastRowNum; i++&lt;span style=&quot;color: #000000;&quot;&gt;)
            {
                &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (recordcount &gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
                {
                    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (i &gt; (recordcount + &lt;span style=&quot;color: #800080;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;))
                        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                }
                HSSFRow row &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; sheet.GetRow(i);
                DataRow dataRow &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; dt.NewRow();

                &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; j = row.FirstCellNum; j &lt; cellCount; j++&lt;span style=&quot;color: #000000;&quot;&gt;)
                {
                    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (row.GetCell(j) != &lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
                    {
                        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(dt.Columns.Count&gt;&lt;span style=&quot;color: #000000;&quot;&gt;j)
                           dataRow[j] &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; row.GetCell(j).ToString();
                    }
                }

                dt.Rows.Add(dataRow);
            }
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; dt;
        }

        &lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;summary&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 获取Sheet列信息
        &lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;/summary&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;param name=&quot;strFileName&quot;&gt;&lt;/param&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;param name=&quot;sheetindex&quot;&gt;&lt;/param&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;param name=&quot;topcount&quot;&gt;&lt;/param&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;returns&gt;&lt;/returns&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #0000ff;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt; System.Collections.Generic.List&lt;&lt;span style=&quot;color: #0000ff;&quot;&gt;string&lt;/span&gt;&gt; GetSheetColumns(&lt;span style=&quot;color: #0000ff;&quot;&gt;string&lt;/span&gt; strFileName, &lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; sheetindex, &lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; topcount)
        {

            HSSFWorkbook hssfworkbook;
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;using&lt;/span&gt; (FileStream file = &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; FileStream(strFileName, FileMode.Open, FileAccess.Read))
            {
                hssfworkbook &lt;/span&gt;= &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; HSSFWorkbook(file);
            }

            HSSFSheet sheet &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; hssfworkbook.GetSheetAt(sheetindex);
            System.Collections.IEnumerator rows &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; sheet.GetRowEnumerator();
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (topcount &lt; &lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
                topcount &lt;/span&gt;= &lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
            HSSFRow headerRow &lt;/span&gt;= sheet.GetRow(&lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt; + topcount - &lt;span style=&quot;color: #800080;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; cellCount =&lt;span style=&quot;color: #000000;&quot;&gt; headerRow.LastCellNum;
            System.Collections.Generic.List&lt;/span&gt;&lt;&lt;span style=&quot;color: #0000ff;&quot;&gt;string&lt;/span&gt;&gt; list = &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt; System.Collections.Generic.List&lt;&lt;span style=&quot;color: #0000ff;&quot;&gt;string&lt;/span&gt;&gt;&lt;span style=&quot;color: #000000;&quot;&gt;();
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; j = &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;; j &lt; cellCount; j++&lt;span style=&quot;color: #000000;&quot;&gt;)
            {
                HSSFCell cell &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; headerRow.GetCell(j);
                &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (cell == &lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
                    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;continue&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
                &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (cell.ToString().Trim().Length &gt; &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)
                {
                    list.Add(cell.ToString());
                }
            }
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; list;
        }

        &lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;summary&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; 
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;/summary&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;param name=&quot;strFileName&quot;&gt;&lt;/param&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #808080;&quot;&gt;///&lt;/span&gt; &lt;span style=&quot;color: #808080;&quot;&gt;&lt;returns&gt;&lt;/returns&gt;&lt;/span&gt;
        &lt;span style=&quot;color: #0000ff;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt; System.Collections.Generic.Dictionary&lt;&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;string&lt;/span&gt;&gt; GetSheetList(&lt;span style=&quot;color: #0000ff;&quot;&gt;string&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; strFileName)
        {
            HSSFWorkbook hssfworkbook;
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;using&lt;/span&gt; (FileStream file = &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; FileStream(strFileName, FileMode.Open, FileAccess.Read))
            {
                hssfworkbook &lt;/span&gt;= &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; HSSFWorkbook(file);
            }

            System.Collections.Generic.Dictionary&lt;/span&gt;&lt;&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;string&lt;/span&gt;&gt; lists = &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt; System.Collections.Generic.Dictionary&lt;&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;string&lt;/span&gt;&gt;&lt;span style=&quot;color: #000000;&quot;&gt;();

            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;for&lt;/span&gt; (&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; i = &lt;span style=&quot;color: #800080;&quot;&gt;0&lt;/span&gt;; i &lt; hssfworkbook.NumberOfSheets; i++&lt;span style=&quot;color: #000000;&quot;&gt;)
            {
                lists.Add(i, hssfworkbook.GetSheetName(i));
            }
            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; lists;
        }
    }&lt;/span&gt;</code></pre></div></div>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://aiho.site/2016/08/03/2016-08-03%2010-40_java%20%E5%AE%9E%E4%BD%93%E5%AF%B9%E8%B1%A1%E8%BD%ACMap%E5%85%AC%E5%85%B1%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Li ChengHu">
      <meta itemprop="description" content="��ͨ��ֻ�뵽��ζȹ�ʱ�䣬�в��ܵ����跨����ʱ�䡣�����屾��">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aiho.site">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/08/03/2016-08-03%2010-40_java%20%E5%AE%9E%E4%BD%93%E5%AF%B9%E8%B1%A1%E8%BD%ACMap%E5%85%AC%E5%85%B1%E7%B1%BB/" class="post-title-link" itemprop="url">java 实体对象转Map公共类</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-08-03 10:40:00" itemprop="dateCreated datePublished" datetime="2016-08-03T10:40:00+08:00">2016-08-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 00:08:12" itemprop="dateModified" datetime="2020-05-28T00:08:12+08:00">2020-05-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><span style="font-size: 1.17em; line-height: 1.5;">java 实体对象转Map公共类 </span></p>
<p><span style="color: #0000ff;">package</span><span style="color: #000000;"> org.kxtkx.portal.utils;</p>
<pre><code>&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;import&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; java.lang.reflect.Field;
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;import&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; java.util.HashMap;
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;import&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; java.util.Map;
&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;import&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; org.kxtkx.portal.user.Admin;
&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;/**&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;
 * 
 * &lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;@author&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; &lt;a href=&quot;mailto:wangc@kxtkx.com&quot;&gt;王成&lt;/a&gt; 
 * @created in 2011-6-24 - 下午02:58:50
 * 本类说明：对象转Map
 &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;*/&lt;/span&gt;
&lt;span style=&quot;color: #0000ff;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;class&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; ObjAnalysis {

 &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; Map ConvertObjToMap(Object obj){
  Map&lt;/span&gt;&lt;String,Object&gt; reMap = &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt; HashMap&lt;String,Object&gt;&lt;span style=&quot;color: #000000;&quot;&gt;();
  &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt; (obj == &lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;) 
   &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
  Field[] fields &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; obj.getClass().getDeclaredFields();
  &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; {
   &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;for&lt;/span&gt;(&lt;span style=&quot;color: #0000ff;&quot;&gt;int&lt;/span&gt; i=0;i&lt;fields.length;i++&lt;span style=&quot;color: #000000;&quot;&gt;){
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; {
     Field f &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; obj.getClass().getDeclaredField(fields[i].getName());
     f.setAccessible(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
           Object o &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; f.get(obj);
           reMap.put(fields[i].getName(), o);
    } &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (NoSuchFieldException e) {
     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;
&lt;span style=&quot;color: #000000;&quot;&gt;     e.printStackTrace();
    } &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (IllegalArgumentException e) {
     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;
&lt;span style=&quot;color: #000000;&quot;&gt;     e.printStackTrace();
    } &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (IllegalAccessException e) {
     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;
&lt;span style=&quot;color: #000000;&quot;&gt;     e.printStackTrace();
    }
   }
  } &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (SecurityException e) {
   &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;
&lt;span style=&quot;color: #000000;&quot;&gt;   e.printStackTrace();
  } 
  &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; reMap;
 }

 &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; main(String[] args) {
  Admin a &lt;/span&gt;= &lt;span style=&quot;color: #0000ff;&quot;&gt;new&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; Admin();
  a.setCPassword(&lt;/span&gt;&quot;123456&quot;&lt;span style=&quot;color: #000000;&quot;&gt;);
  a.setCUsername(&lt;/span&gt;&quot;王成&quot;&lt;span style=&quot;color: #000000;&quot;&gt;);
  Map m &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; ConvertObjToMap(a);
  System.out.println(m);
 }
}&lt;/span&gt;</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://aiho.site/2016/07/22/2016-07-22%2009-41_C#%E4%B8%AD%E7%9A%84SqlBulkCopy%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Li ChengHu">
      <meta itemprop="description" content="��ͨ��ֻ�뵽��ζȹ�ʱ�䣬�в��ܵ����跨����ʱ�䡣�����屾��">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aiho.site">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/07/22/2016-07-22%2009-41_C#%E4%B8%AD%E7%9A%84SqlBulkCopy%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">C#中的SqlBulkCopy批量插入数据</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-07-22 09:41:00" itemprop="dateCreated datePublished" datetime="2016-07-22T09:41:00+08:00">2016-07-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 00:08:12" itemprop="dateModified" datetime="2020-05-28T00:08:12+08:00">2020-05-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C#</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在C#中，我们可以使用sqlBulkCopy去批量插入数据，其他批量插入方法不在讨论。</p>
<p><span style="color: #008080;"> 1</span>         <span style="color: #808080;">///</span> <span style="color: #808080;"><summary></span><br>    <span style="color: #008080;"> 2</span>         <span style="color: #808080;">///</span><span style="color: #008000;"> SqlBulkCopy批量插入数据<br>    </span><span style="color: #008080;"> 3</span>         <span style="color: #808080;">///</span> <span style="color: #808080;"></summary></span><br>    <span style="color: #008080;"> 4</span>         <span style="color: #808080;">///</span> <span style="color: #808080;"><param name="connectionStr"></span><span style="color: #008000;">链接字符串</span><span style="color: #808080;"></param></span><br>    <span style="color: #008080;"> 5</span>         <span style="color: #808080;">///</span> <span style="color: #808080;"><param name="dataTableName"></span><span style="color: #008000;">表名</span><span style="color: #808080;"></param></span><br>    <span style="color: #008080;"> 6</span>         <span style="color: #808080;">///</span> <span style="color: #808080;"><param name="sourceDataTable"></span><span style="color: #008000;">数据源</span><span style="color: #808080;"></param></span><br>    <span style="color: #008080;"> 7</span>         <span style="color: #808080;">///</span> <span style="color: #808080;"><param name="batchSize"></span><span style="color: #008000;">一次事务插入的行数</span><span style="color: #808080;"></param></span><br>    <span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> SqlBulkCopyByDataTable(<span style="color: #0000ff;">string</span> connectionStr, <span style="color: #0000ff;">string</span> dataTableName, DataTable sourceDataTable, <span style="color: #0000ff;">int</span> batchSize = <span style="color: #800080;">100000</span><span style="color: #000000;">)<br>    </span><span style="color: #008080;"> 9</span> <span style="color: #000000;">        {<br>    </span><span style="color: #008080;">10</span>             <span style="color: #0000ff;">using</span> (SqlConnection connection=<span style="color: #0000ff;">new</span><span style="color: #000000;"> SqlConnection(connectionStr))<br>    </span><span style="color: #008080;">11</span> <span style="color: #000000;">            {<br>    </span><span style="color: #008080;">12</span>                 <span style="color: #0000ff;">using</span> (SqlBulkCopy sqlBulkCopy=<span style="color: #0000ff;">new</span><span style="color: #000000;"> SqlBulkCopy(connectionStr,SqlBulkCopyOptions.UseInternalTransaction))<br>    </span><span style="color: #008080;">13</span> <span style="color: #000000;">                {<br>    </span><span style="color: #008080;">14</span>                     <span style="color: #0000ff;">try</span><br>    <span style="color: #008080;">15</span> <span style="color: #000000;">                    {<br>    </span><span style="color: #008080;">16</span>                         sqlBulkCopy.DestinationTableName =<span style="color: #000000;"> dataTableName;<br>    </span><span style="color: #008080;">17</span>                         sqlBulkCopy.BatchSize =<span style="color: #000000;"> batchSize;<br>    </span><span style="color: #008080;">18</span>                         <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">int</span> i = <span style="color: #800080;">0</span>; i &lt; sourceDataTable.Columns.Count; i++<span style="color: #000000;">)<br>    </span><span style="color: #008080;">19</span> <span style="color: #000000;">                        {<br>    </span><span style="color: #008080;">20</span> <span style="color: #000000;">                            sqlBulkCopy.ColumnMappings.Add(sourceDataTable.Columns[i].ColumnName,sourceDataTable.Columns[i].ColumnName);<br>    </span><span style="color: #008080;">21</span> <span style="color: #000000;">                        }<br>    </span><span style="color: #008080;">22</span> <span style="color: #000000;">                        sqlBulkCopy.WriteToServer(sourceDataTable);<br>    </span><span style="color: #008080;">23</span> <span style="color: #000000;">                    }<br>    </span><span style="color: #008080;">24</span>                     <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception ex)<br>    </span><span style="color: #008080;">25</span> <span style="color: #000000;">                    {<br>    </span><span style="color: #008080;">26</span><br>    <span style="color: #008080;">27</span>                         <span style="color: #0000ff;">throw</span><span style="color: #000000;"> ex;<br>    </span><span style="color: #008080;">28</span> <span style="color: #000000;">                    }<br>    </span><span style="color: #008080;">29</span> <span style="color: #000000;">                }<br>    </span><span style="color: #008080;">30</span> <span style="color: #000000;">            }<br>    </span><span style="color: #008080;">31</span>         }</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://aiho.site/2016/07/22/2016-07-22%2009-38_sql%E4%B8%AD%E7%9A%84Bulk%20%E5%AF%BC%E5%85%A5txt%E6%96%87%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Li ChengHu">
      <meta itemprop="description" content="��ͨ��ֻ�뵽��ζȹ�ʱ�䣬�в��ܵ����跨����ʱ�䡣�����屾��">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aiho.site">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/07/22/2016-07-22%2009-38_sql%E4%B8%AD%E7%9A%84Bulk%20%E5%AF%BC%E5%85%A5txt%E6%96%87%E6%9C%AC/" class="post-title-link" itemprop="url">sql中的Bulk 导入txt文本</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-07-22 09:38:00" itemprop="dateCreated datePublished" datetime="2016-07-22T09:38:00+08:00">2016-07-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 00:08:12" itemprop="dateModified" datetime="2020-05-28T00:08:12+08:00">2020-05-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SQL-Server/" itemprop="url" rel="index"><span itemprop="name">SQL Server</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre><code>通常，我们会对于一个文本文件数据导入到数据库中，不多说，上代码。

   首先，表结构如下.</code></pre><p>　　 <img src="http://7xqdjc.com1.z0.glb.clouddn.com/blog_810947-20160707134052311-879444991.png" alt=""></p>
<p>　　 其次，在我当前D盘中有个文本文件名为2.txt的文件。</p>
<p>　　<img src="http://7xqdjc.com1.z0.glb.clouddn.com/blog_810947-20160707134216999-58849935.png" alt=""></p>
<p>　　在数据库中，可以这样通过一句代码插入。</p>
<pre><code>&lt;span style=&quot;color: #0000ff;&quot;&gt;Bulk&lt;/span&gt;  &lt;span style=&quot;color: #0000ff;&quot;&gt;insert&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;  T_Demo
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;From&lt;/span&gt;  &lt;span style=&quot;color: #ff0000;&quot;&gt;&apos;&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;D:\2.txt&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&apos;&lt;/span&gt;
    &lt;span style=&quot;color: #0000ff;&quot;&gt;With&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;
    (  
        fieldterminator&lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&apos;&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&apos;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;,
        rowterminator&lt;/span&gt;&lt;span style=&quot;color: #808080;&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&apos;&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&apos;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;
    )    &lt;/span&gt;</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://aiho.site/2016/07/01/2016-07-01%2009-47_%E9%80%9A%E8%BF%87SQL%E8%87%AA%E5%8A%A8%E6%B7%BB%E5%8A%A0%E6%B5%81%E6%B0%B4%E5%8F%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Li ChengHu">
      <meta itemprop="description" content="��ͨ��ֻ�뵽��ζȹ�ʱ�䣬�в��ܵ����跨����ʱ�䡣�����屾��">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="aiho.site">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/07/01/2016-07-01%2009-47_%E9%80%9A%E8%BF%87SQL%E8%87%AA%E5%8A%A8%E6%B7%BB%E5%8A%A0%E6%B5%81%E6%B0%B4%E5%8F%B7/" class="post-title-link" itemprop="url">通过SQL自动添加流水号</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-07-01 09:47:00" itemprop="dateCreated datePublished" datetime="2016-07-01T09:47:00+08:00">2016-07-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 00:08:13" itemprop="dateModified" datetime="2020-05-28T00:08:13+08:00">2020-05-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>通过SQL自动添加流水号  </p>
<pre><code>项目中往往有一些单据流水号或者流程流水号是希望通过新增一条记录后自动产生一个编号的，比如新增一条流程就自动根据当前日期自动添加该流程的流程流水号，下面介绍两种不同类型流水号通过SQL自动产生的方法。  
流水号格式：  www.2cto.com    

     第一种（数值类型）：日期+流水号，比如“201104190001”--&gt;&quot;201104190002&quot;；   

     第二种（文本类型）：前缀+日期+流水号，比如“WT201104190001”--&gt;&quot;WT201104190002&quot;。  

不论哪种情况，流水号的生成原则都是一样的，流水号的产生都需要根据当前日期产生，新增的一条记录的流水号为当前日期下所有记录中流水号最大那条加1得来。  </code></pre><p>  <a href="http://www.2cto.com" target="_blank" rel="noopener">www.2cto.com</a><br>   一、数据库中添加一个表：TestNo  </p>
<pre><code>列名       数据类型                   说明  

ID         uniqueidentifier          主键  

No         bigint                        流水号字段，不过是纯数字型的流水号，这个为本例子的第一种情况，流水号可以为纯数字  

DT         datetime                   新增一条记录的当前时间，相信每新增一条记录都会记录这次操作的当前时间的。  

CharNo   varchar(50)               流水号字段，不过是可以有字符的流水号，这个为本例子的第二种情况。  </code></pre><h2 id="二、SQL代码"><a href="#二、SQL代码" class="headerlink" title="  二、SQL代码  "></a>  二、SQL代码  </h2><h2 id="–自动流水号为纯数字的情况，如-201104190005"><a href="#–自动流水号为纯数字的情况，如-201104190005" class="headerlink" title="–自动流水号为纯数字的情况，如 201104190005  "></a>–自动流水号为纯数字的情况，如 201104190005  </h2><p>declare<br>@x int,<br>@y char(8)<br>select @x= COUNT(no) from TestNo where CAST(DT as date)=CAST(GETDATE() as date)<br>if(@x=0)<br>begin<br>select @y=convert(char(8),getdate(),112)<br>insert TestNo(No,DT) values(<br>@y+’0001’<br>,GETDATE())<br>end<br>else<br>  insert TestNo(No,DT) values(<br>(select MAX(No)+1 from TestNo where CAST(DT as date)=CAST(GETDATE() as date))<br>,GETDATE())<br>select * from TestNo  </p>
<hr>
<h2 id="–自动流水号为字符的情况，如-WT201104190005"><a href="#–自动流水号为字符的情况，如-WT201104190005" class="headerlink" title="–自动流水号为字符的情况，如 WT201104190005  "></a>–自动流水号为字符的情况，如 WT201104190005  </h2><p>declare<br>@x1 int,<br>@y1 char(8)<br>select @x1= COUNT(CharNo) from TestNo where CAST(DT as date)=CAST(GETDATE() as date)<br>if(@x1=0)<br>begin<br>select @y1=convert(char(8),getdate(),112)<br>insert TestNo(CharNo,DT) values(<br>‘WT’+@y1+’0001’<br>,GETDATE())<br>end<br>else<br>begin<br>  insert TestNo(CharNo,DT) values(<br>‘WT’+cast((select MAX(CAST( SUBSTRING(charno,3,12) as bigint))+1 from TestNo where CAST(DT as date)=CAST(GETDATE() as date))as varchar(50))<br>,GETDATE())<br>end<br>select * from TestNo</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Li ChengHu</p>
  <div class="site-description" itemprop="description">��ͨ��ֻ�뵽��ζȹ�ʱ�䣬�в��ܵ����跨����ʱ�䡣�����屾��</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/q111211" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;q111211" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yourname@gmail.com" title="E-Mail → mailto:yourname@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/yourname" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.cnblogs.com/chenghu/" title="CNBlogs → https:&#x2F;&#x2F;www.cnblogs.com&#x2F;chenghu&#x2F;" rel="noopener" target="_blank"><i class="fab fa-cnBlogs fa-fw"></i>CNBlogs</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Li ChengHu</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
